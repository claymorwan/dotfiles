From b6518afe2dcbd07cde4abb15187c90b1e55f5ca5 Mon Sep 17 00:00:00 2001
From: Naomi Roberts <mia@naomieow.xyz>
Date: Thu, 4 Dec 2025 19:59:48 +0000
Subject: [PATCH] Remove Windows-specific dep

Signed-off-by: Naomi Roberts <mia@naomieow.xyz>
---
 electron/package.json       |  1 -
 electron/src/main/app.js    | 17 +----------------
 electron/webpack.config.cjs |  4 +---
 package.json                |  1 -
 pnpm-lock.yaml              | 18 +-----------------
 5 files changed, 3 insertions(+), 38 deletions(-)

diff --git a/electron/package.json b/electron/package.json
index 880b0dd7..824594b2 100644
--- a/electron/package.json
+++ b/electron/package.json
@@ -26,7 +26,6 @@
     "electron-updater": "^6.8.2"
   },
   "dependencies": {
-    "@paymoapp/electron-shutdown-handler": "^1.1.2",
     "@xhayper/discord-rpc": "^1.3.0",
     "concurrently": "^9.2.1",
     "jimp": "0.22.12",
diff --git a/electron/src/main/app.js b/electron/src/main/app.js
index 0b5597d9..8a92c67c 100644
--- a/electron/src/main/app.js
+++ b/electron/src/main/app.js
@@ -7,7 +7,6 @@ import Jimp from 'jimp'
 import fs from 'fs'
 
 import { BrowserWindow, MessageChannelMain, Notification, Tray, Menu, nativeImage, app, dialog, ipcMain, powerMonitor, shell, session } from 'electron'
-import electronShutdownHandler from '@paymoapp/electron-shutdown-handler'
 
 import { development, getWindowState, saveWindowState, getDefaultBounds } from './util.js'
 import Discord from './discord.js'
@@ -162,21 +161,7 @@ export default class App {
       notification.show()
     })
 
-    if (process.platform === 'win32') {
-      app.setAppUserModelId('com.github.rockinchaos.shiru')
-      // this message usually fires in dev-mode from the parent process
-      process.on('message', data => {
-        if (data === 'graceful-exit') this.destroy()
-      })
-      electronShutdownHandler.setWindowHandle(this.mainWindow.getNativeWindowHandle())
-      electronShutdownHandler.blockShutdown('Saving torrent data...')
-      electronShutdownHandler.on('shutdown', async () => {
-        await this.destroy()
-        electronShutdownHandler.releaseShutdown()
-      })
-    } else {
-      process.on('SIGTERM', () => this.destroy())
-    }
+    process.on('SIGTERM', () => this.destroy())
 
     this.mainWindow.loadURL(development ? 'http://localhost:5000/app.html' : `file://${join(__dirname, '/app.html')}`)
 
diff --git a/electron/webpack.config.cjs b/electron/webpack.config.cjs
index ac8742fc..109174bc 100644
--- a/electron/webpack.config.cjs
+++ b/electron/webpack.config.cjs
@@ -71,9 +71,7 @@ module.exports = [
       path: join(__dirname, 'build'),
       filename: 'main.js'
     },
-    externals: {
-      '@paymoapp/electron-shutdown-handler': 'require("@paymoapp/electron-shutdown-handler")'
-    },
+    externals: {},
     resolve: {
       aliasFields: [],
       alias: {
diff --git a/package.json b/package.json
index eed93f59..0355460b 100644
--- a/package.json
+++ b/package.json
@@ -47,7 +47,6 @@
       "capacitor-plugin-safe-area": "patches/capacitor-plugin-safe-area.patch"
     },
     "onlyBuiltDependencies": [
-      "@paymoapp/electron-shutdown-handler",
       "bufferutil",
       "electron",
       "fs-native-extensions",
diff --git a/pnpm-lock.yaml b/pnpm-lock.yaml
index 3dea86aa..41e1b09b 100644
--- a/pnpm-lock.yaml
+++ b/pnpm-lock.yaml
@@ -275,9 +275,6 @@ importers:
 
   electron:
     dependencies:
-      '@paymoapp/electron-shutdown-handler':
-        specifier: ^1.1.2
-        version: 1.1.2
       '@xhayper/discord-rpc':
         specifier: ^1.3.0
         version: 1.3.0(bufferutil@4.0.8)(utf-8-validate@6.0.4)
@@ -888,10 +885,7 @@ packages:
     deprecated: This functionality has been moved to @npmcli/fs
 
   '@obsidize/rx-console@6.2.1':
-    resolution: {integrity: sha512-UXa8S8pNoDmyZ9x2UjU/GJmqEhJ/LGmAI/2V/3njNBQRIxmDFCIPJIavsRv6x+JueNZ4mU1wHE0gU7paT5iWrA==}
-
-  '@paymoapp/electron-shutdown-handler@1.1.2':
-    resolution: {integrity: sha512-/MIC+wdRlVw1Sm56qJcT17O/KBpQARP2tOcAgg1OKB4W83B9IyBBtIoLXkRlpCOEJnGEleuv5HiSBryUgwbFvQ==}
+    resolution: {integrity: sha512-UXa8S8pNoDmyZ9x2UjU/GJmqEhJ/LGmAI/2V/3njNBQRIxmDFCIPJIavsRv6xJueNZ4mU1wHE0gU7paT5iWrA==}
 
   '@pkgjs/parseargs@0.11.0':
     resolution: {integrity: sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==}
@@ -3969,9 +3963,6 @@ packages:
   node-addon-api@4.3.0:
     resolution: {integrity: sha512-73sE9+3UaLYYFmDsFZnqCInzPyh3MqIwZO9cw58yIqAZhONrrabrYyYe3TuIqtIiOuTXVhsGau8hcrhhwSsDIQ==}
 
-  node-addon-api@5.1.0:
-    resolution: {integrity: sha512-eh0GgfEkpnoWDq+VY8OyvYhFEzBk6jIYbRKdIlyTiAXIVJ8PyBaKb0rp7oDtoddbdoHWhq8wwr+XZ81F1rpNdA==}
-
   node-addon-api@6.1.0:
     resolution: {integrity: sha512-+eawOlIgy680F0kBzPUNFhMZGtJ1YmqM6l4+Crf4IkImjYrO/mqPwRMh352g23uIaQKFItcQ64I7KMaJxHgAVA==}
 
@@ -6734,11 +6725,6 @@ snapshots:
 
   '@obsidize/rx-console@6.2.1': {}
 
-  '@paymoapp/electron-shutdown-handler@1.1.2':
-    dependencies:
-      node-addon-api: 5.1.0
-      prebuild-install: 7.1.2
-
   '@pkgjs/parseargs@0.11.0':
     optional: true
 
@@ -10383,8 +10369,6 @@ snapshots:
 
   node-addon-api@4.3.0: {}
 
-  node-addon-api@5.1.0: {}
-
   node-addon-api@6.1.0: {}
 
   node-api-version@0.2.1:
-- 
2.52.0
